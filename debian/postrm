#!/bin/sh

TARGET="/usr/local/lib/PycharmProjects"
PORT=8000
FORCE=0

# Verifica argumento --force
if [ "$1" = "--force" ]; then
    FORCE=1
fi

echo "üßº Preparando para remover o projeto mctest..."

confirm() {
    if [ "$FORCE" -eq 1 ]; then
        return 0
    fi

    read -r -p "$1 [s/N]: " response
    case "$response" in
        [sS][iI]|[sS])
            return 0
            ;;
        *)
            return 1
            ;;
    esac
}

# Verifica se h√° processo na porta 8000
PID=$(lsof -ti tcp:$PORT)

if [ -n "$PID" ]; then
    echo "‚õî Servidor detectado rodando na porta $PORT (PID: $PID)."

    if confirm "Deseja encerrar o servidor?"; then
        kill "$PID"
        sleep 2
        if ps -p "$PID" > /dev/null; then
            echo "‚ö†Ô∏è Processo ainda ativo. For√ßando encerramento..."
            kill -9 "$PID"
        fi
        echo "‚úÖ Servidor encerrado."
    else
        echo "‚ùå Servidor mantido em execu√ß√£o. Interrompendo o script por seguran√ßa."
        exit 1
    fi
else
    echo "‚ÑπÔ∏è Nenhum servidor ativo detectado na porta $PORT."
fi

# Confirma√ß√£o para remover diret√≥rio
if [ -d "$TARGET" ]; then
    if confirm "Deseja remover o diret√≥rio do projeto em $TARGET?"; then
        rm -rf "$TARGET"
        echo "‚úÖ Diret√≥rio removido com sucesso."
    else
        echo "‚ùå Diret√≥rio mantido. Encerrando script."
        exit 0
    fi
else
    echo "‚ö†Ô∏è Diret√≥rio $TARGET n√£o encontrado."
fi
